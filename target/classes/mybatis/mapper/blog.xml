<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="blog">

	<insert id="makeBlog" parameterType="blogvo">
	<![CDATA[
	insert into blog values(#{userId}, #{title}, #{logo})
	]]>
	</insert>
	
	<update id="updateBlog" parameterType="blogvo">
	<![CDATA[
	update blog set title=#{title}, logo=#{logo} where user_id=#{userId}
	]]>
	</update>

	<!-- getCategoryList -->
	<select id="getCategoryList" resultType="categoryvo">
	<![CDATA[
	select c.no, c.subject, count(p.category_no) as postCount, c.description
	from category c, post p
	where c.no=p.category_no
	group by c.no, c.subject, c.description
  	]]>
	</select>
	
	<!-- insertCategory -->
	<insert id="insertCategory" parameterType="categoryvo">
	<![CDATA[
	insert into category values(null,#{subject},#{description},now(),#{userId})
	]]>
	</insert>
	
	<delete id="deleteCategory" parameterType="long">
	<![CDATA[
	delete from category where no=#{no}
	]]>
	</delete>
	
	<delete id="deletePost" parameterType="long">
	<![CDATA[
	delete from post where category_no=#{categoryNo}
	]]>
	</delete>
	
	<!-- getPostList -->
	<select id="getPostList" resultType="postvo">
	<![CDATA[
	select no,title,reg_date as regDate from post where category_no=#{categoryNo}
 	]]>
	</select>
	
	<!-- getInfo -->
	<select id="getInfo" resultType="blogvo" parameterType="string">
	<![CDATA[
	select u.id as userId, u.name as userName, b.title, b.logo
	from user u, blog b
	where u.id=#{userId}
	and u.id=b.user_id
	]]>
	</select>


</mapper>